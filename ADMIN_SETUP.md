# 👨‍💼 管理員後台設定指南

## 📋 功能說明

管理員後台提供完整的員工打卡管理功能：

### 四大功能分頁

1. **📊 總覽分頁**
   - 今日出勤狀況（誰在班、誰下班、誰未到）
   - 本週出勤統計圖表
   - 即時統計數據（總員工數、今日出勤、本月工作日、總工時）

2. **👥 員工分頁**
   - 查看所有員工列表
   - 顯示每位員工的本月出勤天數
   - 即時顯示員工狀態（在班/已下班/未到）

3. **📝 出勤分頁**
   - 選擇日期查看當天所有員工的打卡紀錄
   - 顯示上班時間、下班時間、工作時數
   - 完整的出勤表格檢視

4. **💾 匯出分頁**
   - 選擇月份匯出 CSV 報表
   - 包含：員工、日期、上下班時間、工時
   - 可直接複製到 Excel

---

## 🔧 設定步驟

### 1. 更新 Google Sheets「員工資料」欄位

首先需要在 Google Sheets 中新增「角色」欄位：

1. 開啟你的 Google Sheets「員工資料」工作表
2. 在 **F 欄（第 6 欄）** 的標題列（第 1 行）加入：`角色`
3. 標題列應該是：`員工ID | 員工姓名 | LINE顯示名稱 | 註冊時間 | 狀態 | 角色`

### 2. 設定管理員

有兩種方式設定管理員：

#### 方法 A：使用腳本（推薦）

執行設定腳本，會列出所有員工讓你選擇：

```bash
cd C:\Users\User\Documents\GitHub\LINE_CHECKIN
node scripts/set-admin.js
```

**執行流程：**
```
📋 載入員工資料...

目前員工列表：

編號 | 員工姓名 | 身份
-----|----------|-------
1.   | 啊瘦     | 一般員工

請輸入要設定為管理員的員工編號（輸入 0 離開）: 1

✅ 成功！啊瘦 已設定為管理員
```

#### 方法 B：手動編輯 Google Sheets

1. 開啟 Google Sheets「員工資料」工作表
2. 找到要設定為管理員的員工那一行
3. 在該行的 **F 欄（角色）** 填入：`admin`
4. 儲存

**範例：**
```
A欄(員工ID) | B欄(員工姓名) | C欄 | D欄 | E欄(狀態) | F欄(角色)
Uc6c1...    | 啊瘦          | ... | ... | active   | admin
```

### 3. 建立管理員專用 LIFF Endpoint

目前的 LIFF 只有員工介面，需要建立一個管理員入口。

有兩種方式：

#### 選項 A：使用查詢參數（簡單）

直接在原有 LIFF 網址後加上參數：
```
https://liff.line.me/2009133831-iwiCoMdy?page=admin
```

然後修改 `public/liff/app.js` 來檢測這個參數並跳轉到管理頁面。

#### 選項 B：建立獨立的管理員 LIFF App（建議）

1. 前往 [LINE Developers Console](https://developers.line.biz/console/)
2. 選擇你的 Provider 和 Channel
3. 點選「LIFF」分頁
4. 點選「Add」新增 LIFF App
5. 填寫資料：
   - **Name**: `管理員後台`
   - **Size**: `Full`
   - **Endpoint URL**: `https://line-checkin-bot-one.vercel.app/liff/admin.html`
   - **Scopes**: 勾選 `profile`
6. 儲存後會得到新的 LIFF ID（例如：`2009133831-aBcDeFg`）

然後管理員可以用這個專屬網址存取：
```
https://liff.line.me/2009133831-aBcDeFg
```

---

## 📱 使用管理員後台

### 開啟方式

**目前（臨時方案）：**
在瀏覽器直接開啟：
```
https://line-checkin-bot-one.vercel.app/liff/admin.html
```

**正式方案（建立獨立 LIFF 後）：**
在 LINE 中開啟專屬 LIFF 網址：
```
https://liff.line.me/{你的管理員LIFF_ID}
```

### 權限驗證

- 只有在 Google Sheets「員工資料」中 `角色` 欄位為 `admin` 的員工才能存取
- 非管理員會看到「權限不足」的錯誤訊息

---

## 📊 功能使用說明

### 查看今日出勤

1. 開啟管理員後台
2. 預設就在「總覽」分頁
3. 查看「今日出勤狀況」卡片
4. 顯示每位員工的狀態和打卡時間

### 查看特定日期的打卡紀錄

1. 切換到「出勤」分頁
2. 選擇日期（預設為今天）
3. 點選「搜尋」按鈕
4. 查看完整的出勤表格

### 匯出月報表

1. 切換到「匯出」分頁
2. 選擇要匯出的月份
3. 點選「匯出 CSV 檔案」
4. 檔案會自動下載（檔名：`出勤記錄_2026-02.csv`）
5. 可以用 Excel 開啟

**CSV 格式：**
```csv
員工,日期,上班時間,下班時間,工時
啊瘦,2026-02-15,09:00:00,18:00:00,9.0
```

---

## 🔐 安全性注意事項

1. **管理員權限**：
   - 只在 Google Sheets 中設定信任的員工為管理員
   - 管理員可以查看所有員工的打卡紀錄

2. **API 安全**：
   - `/api/admin/*` 端點會檢查管理員權限
   - 非管理員無法透過 API 取得資料

3. **Google Sheets 權限**：
   - 確保 Google Sheets 不要公開分享
   - 只有 Service Account 和你本人可以存取

---

## ⚠️ 常見問題

### Q1: 開啟管理員後台顯示「權限不足」？

**解決方法：**
1. 確認你的帳號在 Google Sheets「員工資料」中
2. 確認 F 欄（角色）欄位為 `admin`
3. 確認標題列（第 1 行）的 F 欄有「角色」標題
4. 重新開啟 LIFF 頁面

### Q2: 看不到任何員工資料？

**檢查清單：**
1. 確認 Google Sheets「員工資料」有資料
2. 確認環境變數 `GOOGLE_SHEET_ID` 正確
3. 檢查 Vercel Functions 日誌是否有錯誤

### Q3: 匯出的 CSV 在 Excel 中亂碼？

這是編碼問題，解決方法：
1. 在 Excel 中：資料 → 從文字/CSV → 選擇檔案 → 編碼選擇「UTF-8」
2. 或使用 Google Sheets 開啟 CSV 檔案

### Q4: 想新增更多管理員？

重複「設定管理員」步驟即可，可以有多位管理員。

---

## 🎯 進階功能建議

未來可以加入：

1. **員工管理**：
   - 新增/編輯/停用員工
   - 重置員工打卡紀錄

2. **補打卡審核**：
   - 員工申請補打卡
   - 管理員審核批准

3. **統計圖表**：
   - 月度出勤趨勢圖
   - 員工工時排行榜
   - 遲到早退統計

4. **推播通知**：
   - 管理員可以推送訊息給所有員工
   - 公告系統

5. **權限細分**：
   - 超級管理員（可設定其他管理員）
   - 一般管理員（只能查看資料）

---

## ✅ 快速檢查清單

設定完成後，確認以下項目：

- [ ] Google Sheets「員工資料」已新增「角色」欄位（F 欄）
- [ ] 至少有一位員工的角色設定為 `admin`
- [ ] 可以成功開啟管理員後台（沒有「權限不足」錯誤）
- [ ] 能看到所有員工列表
- [ ] 能看到今日出勤狀況
- [ ] 能選擇日期查看出勤紀錄
- [ ] 能成功匯出 CSV 報表

---

## 📞 需要協助？

如果遇到問題：
1. 檢查 Vercel Functions 日誌
2. 檢查瀏覽器 Console 是否有錯誤
3. 確認 Google Sheets 結構正確

**完成後，你就擁有完整的員工打卡管理系統了！** 🎉
