# ğŸ—ï¸ ç³»çµ±æ¶æ§‹èªªæ˜

## ğŸ“Š ç³»çµ±æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LINE User  â”‚
â”‚  (å“¡å·¥æ‰‹æ©Ÿ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ç™¼é€è¨Šæ¯ (ä¾‹å¦‚ï¼šä¸Šç­)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LINE Server    â”‚
â”‚  (LINE Platform) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Webhook (HTTPS)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä½ çš„ä¼ºæœå™¨              â”‚
â”‚   (Node.js + Express)    â”‚
â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  index.js          â”‚  â”‚ â† ä¸»ç¨‹å¼å…¥å£
â”‚  â”‚  (Webhook æ¥æ”¶)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  lineBot.js        â”‚  â”‚ â† è™•ç† LINE è¨Šæ¯
â”‚  â”‚  (è¨Šæ¯è™•ç†é‚è¼¯)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ attendanceService.jsâ”‚ â”‚ â† æ‰“å¡æ¥­å‹™é‚è¼¯
â”‚  â”‚  (æ‰“å¡åŠŸèƒ½)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚              â”‚
â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚  è¨˜æ†¶é«”å„²å­˜         â”‚  â”‚ googleSheets  â”‚
â”‚  â”‚  (Map/Array)       â”‚  â”‚  (é›²ç«¯å‚™ä»½)    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Google Sheets  â”‚
                          â”‚  (æ‰“å¡ç´€éŒ„è¡¨)    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å°ˆæ¡ˆæª”æ¡ˆçµæ§‹

```
LINE_CHECKIN/
â”‚
â”œâ”€â”€ ğŸ“„ index.js                    # ä¸»ç¨‹å¼ï¼šExpress ä¼ºæœå™¨ + Webhook
â”‚   â””â”€â”€ è² è²¬ï¼šæ¥æ”¶ LINE Webhookã€è·¯ç”±åˆ†ç™¼
â”‚
â”œâ”€â”€ ğŸ“‚ config/
â”‚   â””â”€â”€ googleSheets.js            # Google Sheets API è¨­å®š
â”‚       â””â”€â”€ è² è²¬ï¼šé€£æ¥ Google Sheetsã€å¯«å…¥è³‡æ–™
â”‚
â”œâ”€â”€ ğŸ“‚ controllers/
â”‚   â””â”€â”€ lineBot.js                 # LINE Bot é‚è¼¯æ§åˆ¶å™¨
â”‚       â””â”€â”€ è² è²¬ï¼šè™•ç† LINE è¨Šæ¯ã€æŒ‡ä»¤è§£æã€å›è¦†è¨Šæ¯
â”‚
â”œâ”€â”€ ğŸ“‚ services/
â”‚   â””â”€â”€ attendanceService.js       # æ‰“å¡æœå‹™
â”‚       â””â”€â”€ è² è²¬ï¼šæ‰“å¡åŠŸèƒ½ã€ç´€éŒ„æŸ¥è©¢ã€è³‡æ–™å„²å­˜
â”‚
â”œâ”€â”€ ğŸ“‚ utils/
â”‚   â””â”€â”€ timeHelper.js              # æ™‚é–“è™•ç†å·¥å…·
â”‚       â””â”€â”€ è² è²¬ï¼šå–å¾—å°ç£æ™‚å€æ™‚é–“ã€æ ¼å¼åŒ–æ—¥æœŸ
â”‚
â”œâ”€â”€ ğŸ“„ .env                        # ç’°å¢ƒè®Šæ•¸ï¼ˆå¯†é‘°ã€è¨­å®šï¼‰
â”œâ”€â”€ ğŸ“„ .env.example                # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ ğŸ“„ .gitignore                  # Git å¿½ç•¥æ¸…å–®
â”œâ”€â”€ ğŸ“„ package.json                # å°ˆæ¡ˆè¨­å®šå’Œä¾è³´å¥—ä»¶
â”‚
â””â”€â”€ ğŸ“š æ–‡ä»¶/
    â”œâ”€â”€ README.md                  # å°ˆæ¡ˆèªªæ˜
    â”œâ”€â”€ QUICKSTART.md              # 5åˆ†é˜å¿«é€Ÿé–‹å§‹
    â”œâ”€â”€ SETUP_GUIDE.md             # å®Œæ•´è¨­å®šæ•™å­¸
    â”œâ”€â”€ TEST.md                    # æ¸¬è©¦æŒ‡å—
    â””â”€â”€ ARCHITECTURE.md            # æœ¬æª”æ¡ˆï¼ˆæ¶æ§‹èªªæ˜ï¼‰
```

---

## ğŸ”„ è³‡æ–™æµç¨‹

### 1ï¸âƒ£ å“¡å·¥è¨»å†Šæµç¨‹

```
å“¡å·¥ç™¼é€ï¼šã€Œè¨»å†Š ç‹å°æ˜ã€
    â†“
LINE Server â†’ Webhook â†’ index.js â†’ lineBot.js
    â†“
è§£æè¨Šæ¯ï¼Œæå–å§“åã€Œç‹å°æ˜ã€
    â†“
å„²å­˜åˆ° Map: employees.set(userId, {name: "ç‹å°æ˜"})
    â†“
å›è¦†ï¼šã€Œâœ… è¨»å†ŠæˆåŠŸï¼ã€
```

### 2ï¸âƒ£ ä¸Šç­æ‰“å¡æµç¨‹

```
å“¡å·¥ç™¼é€ï¼šã€Œä¸Šç­ã€
    â†“
LINE Server â†’ Webhook â†’ index.js â†’ lineBot.js
    â†“
æª¢æŸ¥æ˜¯å¦å·²è¨»å†Šï¼Ÿ
    â”œâ”€ å¦ â†’ å›è¦†ã€Œè«‹å…ˆè¨»å†Šã€
    â””â”€ æ˜¯ â†’ å‘¼å« attendanceService.checkIn()
             â†“
        å–å¾—ç•¶å‰æ™‚é–“ï¼ˆå°ç£æ™‚å€ï¼‰
             â†“
        å„²å­˜æ‰“å¡ç´€éŒ„ï¼š
        â”œâ”€ è¨˜æ†¶é«” Array
        â””â”€ Google Sheets
             â†“
        å›è¦†ï¼šã€Œâœ… ä¸Šç­æ‰“å¡æˆåŠŸï¼æ™‚é–“ï¼š14:30:25ã€
```

### 3ï¸âƒ£ æŸ¥è©¢ç´€éŒ„æµç¨‹

```
å“¡å·¥ç™¼é€ï¼šã€ŒæŸ¥è©¢ã€
    â†“
LINE Server â†’ Webhook â†’ index.js â†’ lineBot.js
    â†“
å‘¼å« attendanceService.getTodayRecords(userId)
    â†“
å¾è¨˜æ†¶é«” Array ç¯©é¸ä»Šæ—¥è©²å“¡å·¥çš„ç´€éŒ„
    â†“
æ ¼å¼åŒ–æˆå¯è®€çš„è¨Šæ¯
    â†“
å›è¦†ï¼šã€ŒğŸ“‹ ä»Šæ—¥æ‰“å¡ç´€éŒ„ï¼š1. ä¸Šç­ - 14:30:25...ã€
```

---

## ğŸ—‚ï¸ è³‡æ–™å„²å­˜æ¶æ§‹

### è¨˜æ†¶é«”å„²å­˜ï¼ˆä¸»è¦ï¼‰

```javascript
// å“¡å·¥è³‡æ–™
employees = Map {
  'U1234567890abcdef' => {
    name: 'ç‹å°æ˜',
    lineDisplayName: 'David Wang',
    registeredAt: '2026-02-14T12:00:00.000Z'
  }
}

// æ‰“å¡ç´€éŒ„
attendanceRecords = [
  {
    userId: 'U1234567890abcdef',
    employeeName: 'ç‹å°æ˜',
    type: 'in',
    date: '2026-02-14',
    time: '09:00:00',
    fullTimestamp: '2026-02-14T01:00:00.000Z'
  },
  // ...æ›´å¤šç´€éŒ„
]
```

### Google Sheets å„²å­˜ï¼ˆå‚™ä»½ï¼‰

| æ—¥æœŸ | æ™‚é–“ | å“¡å·¥å§“å | é¡å‹ | LINE User ID | å®Œæ•´æ™‚é–“æˆ³è¨˜ |
|------|------|---------|------|-------------|-------------|
| 2026-02-14 | 09:00:00 | ç‹å°æ˜ | ä¸Šç­ | U1234... | 2026-02-14T01:00:00.000Z |
| 2026-02-14 | 18:00:00 | ç‹å°æ˜ | ä¸‹ç­ | U1234... | 2026-02-14T10:00:00.000Z |

---

## ğŸ”Œ å¤–éƒ¨ API æ•´åˆ

### LINE Messaging API

```javascript
// ä½¿ç”¨ @line/bot-sdk
const client = new line.messagingApi.MessagingApiClient({
  channelAccessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN
});

// ä¸»è¦åŠŸèƒ½ï¼š
// 1. æ¥æ”¶è¨Šæ¯ (Webhook)
// 2. å›è¦†è¨Šæ¯ (replyMessage)
// 3. å–å¾—ä½¿ç”¨è€…è³‡æ–™ (getProfile)
```

### Google Sheets API

```javascript
// ä½¿ç”¨ googleapis
const auth = new google.auth.GoogleAuth({
  credentials: JSON.parse(fs.readFileSync('google-credentials.json')),
  scopes: ['https://www.googleapis.com/auth/spreadsheets']
});

// ä¸»è¦åŠŸèƒ½ï¼š
// 1. æ–°å¢è³‡æ–™ (spreadsheets.values.append)
// 2. å»ºç«‹æ¨™é¡Œ (spreadsheets.values.update)
```

---

## ğŸ›¡ï¸ å®‰å…¨æ€§è¨­è¨ˆ

### 1. ç’°å¢ƒè®Šæ•¸ä¿è­·
- æ•æ„Ÿè³‡è¨Šï¼ˆTokenã€Secretï¼‰å­˜åœ¨ `.env`
- `.gitignore` é˜²æ­¢ä¸Šå‚³åˆ° Git

### 2. LINE Webhook é©—è­‰
- ä½¿ç”¨ LINE SDK çš„ `middleware(config)` è‡ªå‹•é©—è­‰ç°½å

### 3. éŒ¯èª¤è™•ç†
- æ‰€æœ‰ async æ“ä½œéƒ½æœ‰ try-catch
- éŒ¯èª¤ä¸æœƒæš´éœ²æ•æ„Ÿè³‡è¨Šçµ¦ä½¿ç”¨è€…

---

## ğŸš€ æ“´å……æ€§è¨­è¨ˆ

### ç›®å‰çš„é™åˆ¶

âš ï¸ **è¨˜æ†¶é«”å„²å­˜**ï¼šä¼ºæœå™¨é‡å•Ÿæœƒéºå¤±è³‡æ–™ï¼ˆGoogle Sheets ä¸å—å½±éŸ¿ï¼‰

### æœªä¾†å¯æ“´å……åŠŸèƒ½

1. **è³‡æ–™åº«æ•´åˆ**
   - æ›¿æ›è¨˜æ†¶é«”å„²å­˜ç‚º MongoDB / PostgreSQL
   - æŒä¹…åŒ–å“¡å·¥è³‡æ–™å’Œæ‰“å¡ç´€éŒ„

2. **WiFi é©—è­‰**
   - ä½¿ç”¨ LIFF (LINE Front-end Framework)
   - æª¢æŸ¥ä½¿ç”¨è€… IP æˆ– GPS ä½ç½®

3. **ç®¡ç†å¾Œå°**
   - ä½¿ç”¨ React / Vue å»ºç«‹ç¶²é ä»‹é¢
   - æŸ¥çœ‹æ‰€æœ‰å“¡å·¥æ‰“å¡ç‹€æ³
   - åŒ¯å‡ºå ±è¡¨

4. **é€šçŸ¥åŠŸèƒ½**
   - å®šæ™‚æé†’å“¡å·¥æ‰“å¡
   - ç•°å¸¸æ‰“å¡é€šçŸ¥ç®¡ç†è€…

---

## ğŸ“ˆ æ•ˆèƒ½è€ƒé‡

### ç›®å‰è¨­è¨ˆ
- **åŒæ­¥è™•ç†**ï¼šæ¯å€‹è¨Šæ¯ä¾åºè™•ç†
- **è¨˜æ†¶é«”é™åˆ¶**ï¼šé©åˆå°å‹åœ˜éšŠï¼ˆ<100 äººï¼‰

### å»ºè­°å„ªåŒ–ï¼ˆå¦‚éœ€æ“´å±•ï¼‰
- ä½¿ç”¨ Redis ä½œç‚ºå¿«å–å±¤
- éåŒæ­¥å¯«å…¥ Google Sheetsï¼ˆQueueï¼‰
- ä½¿ç”¨ PM2 é€²è¡Œ cluster mode éƒ¨ç½²

---

## ğŸ”§ æŠ€è¡“æ£§

| é¡åˆ¥ | æŠ€è¡“ |
|------|------|
| åŸ·è¡Œç’°å¢ƒ | Node.js v22 |
| æ¡†æ¶ | Express.js |
| LINE SDK | @line/bot-sdk v9 |
| Google API | googleapis v144 |
| ç’°å¢ƒè®Šæ•¸ | dotenv |
| é–‹ç™¼å·¥å…· | nodemon |

---

## ğŸ“š å»¶ä¼¸é–±è®€

- [LINE Messaging API æ–‡ä»¶](https://developers.line.biz/zh-hant/docs/messaging-api/)
- [Google Sheets API æ–‡ä»¶](https://developers.google.com/sheets/api)
- [Express.js å®˜æ–¹æ–‡ä»¶](https://expressjs.com/)

---

**æ›´æ–°æ—¥æœŸ**: 2026-02-14
**ç‰ˆæœ¬**: v1.0.0
